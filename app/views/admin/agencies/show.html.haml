- content_for :title, "#{translate_helper_translate(:site_title)} - #{@agency.name}"
- temp_rating = @agency.ratings.build(user: @traveler)
- can_manage_agency =(can? :manage, :all) || ((can? :full_read, @agency) && !current_user.nil? && !current_user.agency.nil? && @agency.id == current_user.agency.id)
- if can? :index, Agency
  .col-sm-12
    = link_to translate_helper_translate(:all_agencies), admin_agencies_path, class: 'btn action-button btn-arrow-left'
.row.info-header
  .col-sm-5
    %h1= @agency.name
    -unless @agency.active
      %p= translate_helper_translate(:inactive)
  .col-sm-7.btns
    .pull-right
      -if Rating.feedback_on?
        - if can? :read, temp_rating
          = RateableDecorator.decorate(@agency).rating_in_stars
          %button.btn.action-button{data: {toggle: 'modal', target: "#feedback_modal"}}
            = translate_helper_translate(:feedback)
        - elsif Rating.tripless_feedback?
          -# if creating feedback is allowed, but reading isn't, just load the form into the modal on click
          %button.btn.action-button.btn-default{data: {toggle: 'modal', target: "#feedback_modal", remote: new_agency_rating_path(@agency)}}
            = translate_helper_translate(:feedback)
        = render partial: "ratings/organization_feedback_modal", locals: {rateable: @agency}
      - if @agency.active && can_manage_agency and can? :destroy, @agency
        = button_tag :type => 'button', "data-target" => "#deleteAgencyConfirmDialog", "data-toggle" => "modal", :class => "btn action-button", style: "margin-right:5px;" do
          = translate_helper_translate(:delete)
        #deleteAgencyConfirmDialog.modal.fade.col-sm-12{"aria-describedby" => translate_helper_translate(:remove_agency), :role => "dialog", "aria-hidden" => 'true', :tabindex => "-1"}
          .modal-dialog
            .modal-content
              .modal-header
                = button_tag class: 'btn action-button pull-right', data: {dismiss: 'modal'} do
                  = translate_helper_translate(:cancel)
                = button_to translate_helper_translate(:ok), { action: "destroy", id: @agency.id }, method: :delete, style: "margin-right: 5px;", class: "btn action-button pull-right"
                .modal-title{:style => "text-align:left;"}
                  %b
                    = translate_helper_translate(:site_title)
              .modal-body{:style => "text-align:left;"}
                = translate_helper_translate(:confirm_remove_message) + @agency.name + " ?"
      - if !@agency.active && can_manage_agency && (can? :destroy, @agency)
        = button_tag :type => 'button', "data-target" => "#undeleteAgencyConfirmDialog", "data-toggle" => "modal", :class => "btn action-button", style: "margin-right:5px;" do
          = translate_helper_translate(:undelete)
        #undeleteAgencyConfirmDialog.modal.fade.col-sm-12{"aria-describedby" => translate_helper_translate(:restore_agency), :role => "dialog", "aria-hidden" => 'true', :tabindex => "-1"}
          .modal-dialog
            .modal-content
              .modal-header
                = button_tag class: 'btn action-button pull-right', data: {dismiss: 'modal'} do
                  = translate_helper_translate(:cancel)
                = button_to translate_helper_translate(:ok), { action: "undelete", id: @agency.id }, method: :patch, style: "margin-right: 5px;", class: "btn action-button pull-right"
                .modal-title{:style => "text-align:left;"}
                  %b
                    = translate_helper_translate(:site_title)
              .modal-body{:style => "text-align:left;"}
                = translate_helper_translate(:confirm_restore_message) + " #{@agency.name} ?"
      - if can_manage_agency and can? :update, @agency
        = link_to edit_admin_agency_path(@agency), {class: 'btn action-button', role: 'button'} do
          = icon_label(:edit)
.row
  = render partial: "public_details", locals: {agency: @agency}
  - if can_manage_agency
    .col-sm-6
      .panel.panel-default
        .panel-heading
          %h2.panel-title
            = translate_helper_translate(:internal_contact)
            = add_tooltip("internal_contact_help")
        .panel-body
          %table.table.table-condensed
            %tr
              %td.text-right
                = translate_helper_translate(:name) + ": "
              %td.text-left
                %b= @agency.internal_contact_name
            %tr
              %td.text-right
                = translate_helper_translate(:title)+": "
              %td.text-left
                %b= @agency.internal_contact_title
            %tr
              %td.text-right
                = translate_helper_translate(:phone)+ ": "
              %td.text-left
                %b= @agency.internal_contact_phone
            %tr
              %td.text-right
                = translate_helper_translate(:email)+ ":  "
              %td.text-left
                %b= mail_to @agency.internal_contact_email
            - if @contact
              %tr
                %td.text-right
                  = translate_helper_translate(:user) + ": "
                %td.text-left
                  %b= @contact.name
- if can_manage_agency
  .panel.panel-default#staff
    .panel-heading
      %h2.panel-title
        = translate_helper_translate(:staff_actions)
        = add_tooltip("staff_actions_help")
    .panel-body
      %h3= translate_helper_translate(:administrators)
      %table.ALTtable.table-condensed#admin_table
        %thead
          %tr
            %th= translate_helper_translate(:name)
            %th= translate_helper_translate(:title)
            %th= translate_helper_translate(:phone)
            %th= translate_helper_translate(:email)
        %tbody
          - @admins.each do |s|
            %tr
              %td= s.name.to_s
              %td= s.title.to_s
              %td= s.phone.to_s
              %td= mail_to s.email.to_s

      %h3= translate_helper_translate(:agents)
      %table.ALTtable.table-condensed#agent_table
        %thead
          %tr
            %th= translate_helper_translate(:name)
            %th= translate_helper_translate(:title)
            %th= translate_helper_translate(:phone)
            %th= translate_helper_translate(:email)
        %tbody
          - @agents.each do |s|
            %tr
              %td
                = s.name.to_s
              %td
                = s.title.to_s
              %td
                = s.phone.to_s
              %td
                = mail_to s.email.to_s

= render partial: 'admin/shared/show_comments', locals: {commentable: @agency, can_view_private: can_manage_agency}

:javascript
  $(document).ready(function() {
    $('#agent_table').dataTable( {
          stateSave: true,
          "oLanguage": {
              "sLengthMenu": "Display _MENU_ agents per page",
              "sZeroRecords": "Nothing found - sorry",
              "sInfo": "Showing _START_ to _END_ of _TOTAL_ agents",
              "sInfoEmpty": "Showing 0 to 0 of 0 agencies",
              "sInfoFiltered": "(filtered from _MAX_ total agents)"
          },
          "sDom": "<'row'<'col-sm-6'l>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
      } );
    $('#admin_table').dataTable( {
          stateSave: true,
          "oLanguage": {
              "sLengthMenu": "Display _MENU_ administrators per page",
              "sZeroRecords": "Nothing found - sorry",
              "sInfo": "Showing _START_ to _END_ of _TOTAL_ administrators",
              "sInfoEmpty": "Showing 0 to 0 of 0 administrators",
              "sInfoFiltered": "(filtered from _MAX_ total administrators)"
          },
          "sDom": "<'row'<'col-sm-6'l>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>",
      } );
  } );
